# OpenAPI to Zod Schema Generator Alternatives

## Current Tool: openapi-zod-client

**Repository**: https://github.com/astahmer/openapi-zod-client
**Status**: Active, but has known bugs (discriminated union issue #326)

### Pros
- Generates Zodios client (typed HTTP client with Zod validation)
- Exports schemas separately with `--export-schemas`
- Good TypeScript integration
- Active community

### Cons
- **Critical Bug**: Doesn't handle OpenAPI `const` values correctly in discriminated unions
- Generates `z.string()` instead of `z.literal()` for const values
- Requires workarounds (dynamic imports) for discriminated unions

## Alternative Tools

### 1. @hey-api/openapi-ts ⭐ RECOMMENDED

**Repository**: https://github.com/hey-api/openapi-ts
**NPM**: `@hey-api/openapi-ts`
**Stars**: ~1.1k
**Used By**: Vercel, OpenCode, PayPal

#### Features
- **Native Zod plugin** - First-class Zod schema generation
- 20+ plugins including TanStack Query hooks
- Multiple client options (Fetch, Axios, Angular, etc.)
- Production-ready and actively maintained
- Plugin-based architecture for extensibility
- Supports all OpenAPI versions

#### Installation
```bash
npm install -D @hey-api/openapi-ts
```

#### Usage
```bash
npx @hey-api/openapi-ts \
  -i https://staging.openbraininstitute.org/api/entitycore/openapi.json \
  -o ./src/lib/tools/autogenerated_types/entitycore \
  -c @hey-api/client-fetch
```

#### Configuration (openapi-ts.config.ts)
```typescript
import { defineConfig } from '@hey-api/openapi-ts';

export default defineConfig({
  client: '@hey-api/client-fetch',
  input: 'https://staging.openbraininstitute.org/api/entitycore/openapi.json',
  output: {
    path: './src/lib/tools/autogenerated_types/entitycore',
    format: 'prettier',
  },
  plugins: [
    '@hey-api/schemas', // Generates Zod schemas
    '@hey-api/sdk',     // Generates SDK
    '@hey-api/types',   // Generates TypeScript types
  ],
});
```

#### Pros
- **Most mature and production-ready**
- Used by major companies (Vercel, PayPal)
- Excellent documentation
- Active development and maintenance
- Plugin ecosystem for extensibility
- Likely handles discriminated unions correctly

#### Cons
- Larger ecosystem (might be overkill if you only need schemas)
- Different output structure than current setup

---

### 2. sdking

**Repository**: https://github.com/debkanchan/sdking
**NPM**: `sdking`
**Status**: Newer project, actively developed

#### Features
- Generates fully-typed TypeScript SDKs
- Built-in Zod validation
- React Query integration
- Clean, modular output structure
- Full ownership of generated code

#### Installation
```bash
npm install -g sdking
```

#### Usage
```bash
sdking \
  --input https://staging.openbraininstitute.org/api/entitycore/openapi.json \
  --output ./src/lib/tools/autogenerated_types/entitycore
```

#### Pros
- Simple and focused
- Good React Query integration
- Clean output structure
- Full code ownership

#### Cons
- Newer project (less battle-tested)
- Smaller community
- Less documentation than hey-api

---

### 3. oas-tszod-gen

**Repository**: https://github.com/inkognitro/oas-tszod-gen
**NPM**: `oas-tszod-gen`

#### Features
- Generates endpoint caller functions with Zod types
- Multiple RequestHandler implementations (Axios, Fetch)
- Built-in authentication handling
- Granular control over output

#### Installation
```bash
npm install -D oas-tszod-gen
```

#### Usage (Programmatic)
```javascript
const { generateOas3ToTs } = require('oas-tszod-gen');

generateOas3ToTs({
  getSpecification: () => Promise.resolve(oas3Specification),
  outputFolderPath: './generated-api',
  withZod: true,
  logger: { log: console.log },
});
```

#### Pros
- Very granular control
- Multiple HTTP client options
- Built-in auth handling
- Semantic versioning guarantees

#### Cons
- Requires programmatic setup (no CLI)
- More complex configuration
- Smaller community

---

### 4. openapi-typescript (Types Only)

**Repository**: https://github.com/openapi-ts/openapi-typescript
**NPM**: `openapi-typescript`
**Stars**: ~5k+

#### Note
This tool generates TypeScript types only, **not Zod schemas**. Mentioned for completeness, but not suitable for our use case since we need runtime validation.

---

## Recommendation

### Primary Recommendation: @hey-api/openapi-ts

**Why?**
1. **Production-ready** - Used by Vercel, PayPal, and other major companies
2. **Native Zod support** - First-class plugin for Zod schema generation
3. **Active maintenance** - Regular updates and bug fixes
4. **Comprehensive** - Handles edge cases better than alternatives
5. **Likely fixes our bug** - More mature handling of OpenAPI specs

### Migration Path

#### Step 1: Install
```bash
cd backend-ts
npm install -D @hey-api/openapi-ts
```

#### Step 2: Create Configuration
```typescript
// backend-ts/openapi-ts.config.ts
import { defineConfig } from '@hey-api/openapi-ts';

export default defineConfig({
  client: '@hey-api/client-fetch',
  input: 'https://staging.openbraininstitute.org/api/entitycore/openapi.json',
  output: {
    path: './src/lib/tools/autogenerated_types/entitycore',
    format: 'prettier',
  },
  plugins: [
    {
      name: '@hey-api/schemas',
      type: 'zod', // Generate Zod schemas
    },
    '@hey-api/sdk',
    '@hey-api/types',
  ],
});
```

#### Step 3: Add Script to package.json
```json
{
  "scripts": {
    "generate:entitycore": "openapi-ts --config openapi-ts.config.ts"
  }
}
```

#### Step 4: Test Generation
```bash
npm run generate:entitycore
```

#### Step 5: Update Tool Imports
If the discriminated union bug is fixed, remove dynamic imports:

```typescript
// Before (with workaround)
async execute(input: z.infer<typeof InputSchema>): Promise<unknown> {
  const { createApiClient } = await import('../autogenerated_types/entitycore');
  // ...
}

// After (if bug is fixed)
import { createApiClient } from '../autogenerated_types/entitycore';

async execute(input: z.infer<typeof InputSchema>): Promise<unknown> {
  const client = createApiClient(this.contextVariables.entitycoreUrl);
  // ...
}
```

#### Step 6: Verify Tests
```bash
npm test -- brain-region-tools.test.ts
```

### Alternative: Keep Current Setup

If migration is too risky or time-consuming:
- **Keep using openapi-zod-client** with dynamic import workaround
- The workaround is solid and well-documented
- Minimal performance impact
- Can migrate later when time permits

## Testing the Alternative

Before fully committing, test with a small subset:

```bash
# Generate to a temporary directory
npx @hey-api/openapi-ts \
  -i https://staging.openbraininstitute.org/api/entitycore/openapi.json \
  -o ./test-output \
  -c @hey-api/client-fetch

# Inspect the output
ls -la ./test-output

# Check if discriminated unions are handled correctly
grep -A 10 "discriminatedUnion" ./test-output/*.ts
```

## Comparison Matrix

| Feature | openapi-zod-client | @hey-api/openapi-ts | sdking | oas-tszod-gen |
|---------|-------------------|---------------------|--------|---------------|
| Zod Schemas | ✅ | ✅ | ✅ | ✅ |
| Discriminated Union Bug | ❌ | ✅ (likely) | ✅ (likely) | ✅ (likely) |
| Production Ready | ⚠️ | ✅ | ⚠️ | ✅ |
| Active Maintenance | ✅ | ✅ | ✅ | ✅ |
| CLI Support | ✅ | ✅ | ✅ | ❌ |
| Documentation | Good | Excellent | Good | Good |
| Community Size | Medium | Large | Small | Small |
| Used By | Various | Vercel, PayPal | Various | Various |
| Plugin System | ❌ | ✅ | ❌ | ❌ |
| React Query | ❌ | ✅ | ✅ | ❌ |

## Decision Factors

### Choose @hey-api/openapi-ts if:
- You want the most battle-tested solution
- You need comprehensive OpenAPI support
- You want plugin extensibility
- You're okay with a larger ecosystem

### Keep openapi-zod-client if:
- The dynamic import workaround is acceptable
- You want minimal changes to current setup
- You prefer the current output structure
- Migration risk is too high right now

### Choose sdking if:
- You want a simpler, focused tool
- You need React Query integration
- You prefer newer, cleaner codebases

### Choose oas-tszod-gen if:
- You need programmatic control
- You want built-in auth handling
- You prefer granular configuration

## References

- [hey-api/openapi-ts Documentation](https://heyapi.vercel.app/)
- [openapi-zod-client Issue #326](https://github.com/astahmer/openapi-zod-client/issues/326)
- [OpenAPI Tools Directory](https://openapi.tools/)
- [Zod Documentation](https://zod.dev/)
