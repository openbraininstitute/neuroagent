# Simulation Campaign GetOne Tool Implementation

**Date:** 2025-01-XX
**Status:** ✅ Complete

## Overview

Successfully implemented the TypeScript version of the EntityCore `simulation-campaign-getone` tool, translating from the Python FastAPI backend to the TypeScript Next.js backend.

## Files Created/Modified

### New Files
1. **`backend-ts/src/lib/tools/entitycore/simulation-campaign-getone.ts`**
   - Main tool implementation
   - Retrieves detailed information about a specific simulation campaign by ID
   - Follows established EntityCore tool patterns
   - Uses autogenerated Zod schemas for validation

2. **`backend-ts/src/lib/tools/entitycore/__tests__/simulation-campaign-getone.test.ts`**
   - Comprehensive test suite with 17 tests
   - Tests metadata, instantiation, input validation, and Vercel tool conversion
   - All tests passing ✅

### Modified Files
1. **`backend-ts/src/lib/tools/index.ts`**
   - Added export for `SimulationCampaignGetOneTool`
   - Added import in first dynamic import section (line ~225)
   - Added import in second dynamic import section (line ~437)
   - Added to `toolClasses` array registration
   - Added to `availableClasses` array in `getAvailableToolClasses`
   - Added factory function `entitycore-simulationcampaign-getone` (line ~1310)

## Implementation Details

### Source Translation
- **Python Source:** `backend/src/neuroagent/tools/entitycore_simulationcampaign_getone.py`
- **TypeScript Target:** `backend-ts/src/lib/tools/entitycore/simulation-campaign-getone.ts`
- **Reference Pattern:** `backend-ts/src/lib/tools/entitycore/brain-region-getone.ts`

### Key Features
1. **Input Schema:**
   - Accepts `simulation_campaign_id` as UUID parameter
   - Uses autogenerated schema: `zReadOneSimulationCampaignIdGetData.shape.path.shape.id_`
   - Validates UUID format with Zod

2. **API Integration:**
   - Makes GET request to `/simulation-campaign/{simulation_campaign_id}`
   - Includes `virtual-lab-id` and `project-id` headers when provided
   - Uses ky HTTP client with built-in error handling

3. **Response Enhancement:**
   - Adds `url_link` field to response: `entityFrontendUrl + "/" + response.id`
   - Validates response with `zSimulationCampaignRead` schema
   - Returns extended type with `url_link` property

4. **Error Handling:**
   - Catches HTTPError from ky
   - Provides detailed error messages with status code and response body
   - Throws descriptive errors for debugging

5. **Health Check:**
   - Static `isOnline()` method for service availability checking
   - Checks EntityCore `/health` endpoint

### Tool Metadata
- **Tool Name:** `entitycore-simulationcampaign-getone`
- **Frontend Name:** `Get One Simulation Campaign`
- **Description:** Retrieves detailed information about a specific simulation campaign from the knowledge graph
- **Utterances:**
  - "Get details for this simulation campaign"
  - "Show me information about this simulation campaign"
  - "What are the properties of this simulation campaign?"

## Testing

### Test Coverage
- ✅ Tool metadata validation
- ✅ Tool instantiation with context variables
- ✅ Input schema validation (valid/invalid UUIDs)
- ✅ Required parameter validation
- ✅ Vercel tool format conversion
- ✅ Naming pattern consistency
- ✅ Static method availability

### Test Results
```bash
npm test simulation-campaign-getone.test.ts
✓ 17 tests passed
```

### Integration Tests
```bash
npm test src/lib/tools/__tests__/tool-integration.test.ts
✓ 26 tests passed
```

### Build Verification
```bash
npm run build
✓ Build successful
```

## Autogenerated Schemas Used

From `backend-ts/src/lib/tools/autogenerated_types/entitycore/zod.gen.ts`:

1. **`zReadOneSimulationCampaignIdGetData`** (line ~25917)
   - Path parameter schema with `id_` UUID field
   - Optional headers for `virtual-lab-id` and `project-id`

2. **`zSimulationCampaignRead`** (line ~6709)
   - Complete response schema with all simulation campaign fields
   - Includes name, description, dates, assets, simulations, etc.

## Translation Principles Applied

✅ **Vercel AI SDK First:** Not applicable (no LLM integration in this tool)
✅ **Feature Parity:** Maintains exact functionality from Python version
✅ **Architecture Mapping:** Follows EntityCore tool patterns
✅ **Code Style Adaptations:** Uses TypeScript idioms and ky HTTP client
✅ **Autogenerated Types:** Uses Zod schemas from generated types
✅ **Error Handling:** Implements HTTPError catching with detailed messages
✅ **Documentation:** Includes JSDoc comments and inline documentation

## Comparison with Python Implementation

| Aspect | Python | TypeScript |
|--------|--------|------------|
| HTTP Client | `httpx.AsyncClient` | `ky` |
| Validation | Pydantic `BaseModel` | Zod schemas |
| Error Handling | `ValueError` with status check | `HTTPError` catch with ky |
| Type Safety | Python type hints | TypeScript strict types |
| Response Enhancement | Dict modification | Object spread with type extension |
| Health Check | `@classmethod` | `static` method |

## Integration Points

### Tool Registration
The tool is registered in multiple places in `backend-ts/src/lib/tools/index.ts`:

1. **Export:** Line ~71
2. **Dynamic Import (Section 1):** Line ~225
3. **Dynamic Import (Section 2):** Line ~437
4. **Tool Classes Array:** Line ~312
5. **Available Classes Array:** Line ~502
6. **Factory Function:** Line ~1310

### Factory Function
```typescript
if (toolName === 'entitycore-simulationcampaign-getone') {
  if (!config.entitycoreUrl || !config.entityFrontendUrl) {
    throw new Error('EntityCore tools require entitycoreUrl and entityFrontendUrl');
  }

  const { SimulationCampaignGetOneTool } = await import('./entitycore/simulation-campaign-getone');
  return new SimulationCampaignGetOneTool({
    httpClient: config.httpClient,
    entitycoreUrl: config.entitycoreUrl,
    entityFrontendUrl: config.entityFrontendUrl,
    vlabId: config.vlabId,
    projectId: config.projectId,
  });
}
```

## Usage Example

```typescript
import { SimulationCampaignGetOneTool } from '@/lib/tools/entitycore/simulation-campaign-getone';
import ky from 'ky';

// Create tool instance
const tool = new SimulationCampaignGetOneTool({
  httpClient: ky.create(),
  entitycoreUrl: 'https://api.entitycore.example.com',
  entityFrontendUrl: 'https://frontend.example.com',
  vlabId: '123e4567-e89b-12d3-a456-426614174000',
  projectId: '123e4567-e89b-12d3-a456-426614174001',
});

// Execute tool
const result = await tool.execute({
  simulation_campaign_id: '987fcdeb-51a2-43f7-8b9c-123456789abc',
});

console.log(result.name); // Simulation campaign name
console.log(result.url_link); // Frontend URL
```

## Next Steps

This tool is now ready for use in the TypeScript backend. It can be:
- Called by the agent routine during conversation flows
- Used in API endpoints for simulation campaign retrieval
- Integrated with the frontend for displaying simulation campaign details

## Related Tools

- `simulation-campaign-getall.ts` - List all simulation campaigns
- `simulation-getone.ts` - Get individual simulation details
- `simulation-execution-getone.ts` - Get simulation execution details
- `simulation-generation-getone.ts` - Get simulation generation details

## References

- Python Source: `backend/src/neuroagent/tools/entitycore_simulationcampaign_getone.py`
- Translation Guide: `.kiro/rules/typescript-translation.md`
- EntityCore API Documentation: (internal)
