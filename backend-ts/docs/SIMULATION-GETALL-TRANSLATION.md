# Simulation GetAll Tool Translation

## Summary

Successfully translated the EntityCore Simulation GetAll tool from Python to TypeScript.

**Source:** `backend/src/neuroagent/tools/entitycore_simulation_getall.py`
**Target:** `backend-ts/src/lib/tools/entitycore/simulation-getall.ts`
**Test:** `backend-ts/src/lib/tools/entitycore/__tests__/simulation-tools.test.ts`

## Implementation Details

### Tool Metadata
- **Tool Name:** `entitycore-simulation-getall`
- **Frontend Name:** Get All Simulations
- **Purpose:** Search and retrieve simulations from the EntityCore knowledge graph

### Key Features

1. **Input Schema**
   - Uses autogenerated Zod schemas from `zReadManySimulationGetData`
   - Restricts `page_size` to 1-10 (default: 5)
   - Supports brain region filtering with `within_brain_region_brain_region_id`
   - Direction control: `ascendants`, `descendants`, or `ascendants_and_descendants`

2. **Brain Region Hierarchy Lookup**
   - When `within_brain_region_brain_region_id` is provided, fetches the `hierarchy_id`
   - Adds `hierarchy_id` to query parameters for proper filtering
   - Only includes `within_brain_region_direction` when hierarchy filtering is active

3. **Response Processing**
   - Sets `assets` to empty array for each simulation (matching Python behavior)
   - Adds `url_link` field pointing to the entity frontend
   - Validates response with Zod schema

4. **Error Handling**
   - HTTPError handling with detailed error messages
   - Proper status code checking

5. **Health Check**
   - Static `isOnline()` method for service availability checking

## Translation Patterns

### Python → TypeScript Equivalents

| Python | TypeScript |
|--------|-----------|
| `SimulationGetAllInput` (Pydantic) | `SimulationGetAllInputSchema` (Zod) |
| `EntitycoreExcludeBRParams` | Schema extension with custom overrides |
| `ReadManySimulationGetParametersQuery` | `zReadManySimulationGetData.shape.query` |
| `ListResponseSimulationRead` | `zListResponseSimulationRead` |
| `httpx_client.get()` | `httpClient.get()` (ky) |
| `@classmethod async def is_online()` | `static async isOnline()` |

### Key Differences from Python

1. **Schema Definition**
   - Python uses Pydantic model inheritance
   - TypeScript uses Zod schema composition with `.extend()`

2. **Query Parameter Handling**
   - Python: `model_dump(exclude_defaults=True, mode="json")`
   - TypeScript: Manual object construction with undefined checks

3. **HTTP Client**
   - Python: httpx with explicit status code checking
   - TypeScript: ky with automatic JSON parsing and HTTPError handling

4. **Type Safety**
   - Python: Runtime validation with Pydantic
   - TypeScript: Compile-time + runtime validation with Zod

## Registration

The tool is registered in `backend-ts/src/lib/tools/index.ts`:

1. **Export:** `export * from './entitycore/simulation-getall'`
2. **Import in `registerToolClasses()`:** Dynamic import for class registration
3. **Import in `getAvailableToolClasses()`:** Conditional availability based on config
4. **Tool instantiation in `createToolInstance()`:** Case for `entitycore-simulation-getall`

## Testing

Comprehensive test suite in `simulation-tools.test.ts`:

- ✅ Tool metadata validation
- ✅ Tool instantiation
- ✅ Input schema validation
- ✅ Page size constraints (1-10)
- ✅ Direction enum validation
- ✅ UUID format validation
- ✅ Default values
- ✅ Vercel tool format conversion
- ✅ Static `isOnline()` method presence

**Test Results:** All 8 tests pass (part of 755 passing EntityCore tests)

## Files Modified

1. **Created:**
   - `backend-ts/src/lib/tools/entitycore/simulation-getall.ts` (7,409 bytes)
   - `backend-ts/src/lib/tools/entitycore/__tests__/simulation-tools.test.ts`

2. **Modified:**
   - `backend-ts/src/lib/tools/index.ts` (4 locations)
     - Added export statement
     - Added import in `registerToolClasses()`
     - Added to toolClasses array
     - Added import in `getAvailableToolClasses()`
     - Added to availableClasses array
     - Added case in `createToolInstance()`

## Verification

```bash
# Run tests
npm test simulation-tools.test.ts
# Result: ✓ 8 tests passed

# Run all EntityCore tests
npm test entitycore
# Result: ✓ 755 tests passed

# Type check
npm run type-check
# Result: No errors
```

## Usage Example

```typescript
import { SimulationGetAllTool } from '@/lib/tools';

const tool = new SimulationGetAllTool({
  httpClient: kyInstance,
  entitycoreUrl: 'https://api.entitycore.example.com',
  entityFrontendUrl: 'https://entitycore.example.com',
  vlabId: 'virtual-lab-uuid',
  projectId: 'project-uuid',
});

const result = await tool.execute({
  page_size: 5,
  within_brain_region_brain_region_id: 'brain-region-uuid',
  within_brain_region_direction: 'ascendants_and_descendants',
});

console.log(`Found ${result.data.length} simulations`);
```

## Notes

- Follows the exact pattern established by `simulation-campaign-getall.ts`
- Maintains feature parity with Python implementation
- Uses native Vercel AI SDK patterns where applicable
- Properly handles brain region hierarchy lookups
- Includes comprehensive error handling and validation
