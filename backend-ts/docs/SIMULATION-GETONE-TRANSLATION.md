# Simulation GetOne Tool Translation

## Summary

Successfully translated the EntityCore Simulation GetOne tool from Python to TypeScript.

**Source:** `backend/src/neuroagent/tools/entitycore_simulation_getone.py`
**Target:** `backend-ts/src/lib/tools/entitycore/simulation-getone.ts`

## Implementation Details

### Tool Metadata
- **Tool Name:** `entitycore-simulation-getone`
- **Frontend Name:** Get One Simulation
- **Purpose:** Retrieves detailed information about a specific simulation from the knowledge graph

### Key Features
1. **Input Validation:** Uses Zod schema with autogenerated types from `zReadOneSimulationIdGetData`
2. **UUID Parameter:** Accepts `simulation_id` as a UUID-formatted string
3. **Headers Support:** Includes optional `vlab-id` and `project-id` headers
4. **Response Validation:** Returns validated `SimulationRead` schema
5. **Error Handling:** Proper HTTPError handling with detailed error messages
6. **Health Check:** Static `isOnline()` method for service availability

### Files Created/Modified

#### Created:
- `backend-ts/src/lib/tools/entitycore/simulation-getone.ts` - Main tool implementation
- `backend-ts/src/lib/tools/entitycore/__tests__/simulation-tools.test.ts` - Unit tests

#### Modified:
- `backend-ts/src/lib/tools/index.ts` - Added tool registration in three locations:
  - Import statement (line ~218)
  - Tool class registration (line ~302)
  - Factory function (line ~1246)

## Translation Approach

### Pattern Followed
The implementation follows the established EntityCore tool pattern, specifically mirroring `brain-region-getone.ts`:

1. **Input Schema:** Uses autogenerated Zod schemas from `entitycore/zod.gen.ts`
2. **Class Structure:** Extends `BaseTool` with `EntitycoreContextVariables`
3. **Static Metadata:** Tool name, description, utterances as static readonly properties
4. **Execute Method:** Async method that constructs URL, adds headers, makes HTTP request
5. **Error Handling:** HTTPError catching with detailed error messages
6. **Health Check:** Static method for service availability testing

### Key Differences from Python

| Python | TypeScript |
|--------|-----------|
| `SimulationGetOneInput(BaseModel)` | Zod schema with `.describe()` |
| `metadata.httpx_client.get()` | `httpClient.get().json()` (ky) |
| `response.status_code != 200` | HTTPError exception handling |
| `@classmethod` | `static async` method |
| Pydantic `SimulationRead` | Zod `zSimulationRead.parse()` |

## Testing

### Test Coverage
- ✅ Correct metadata (name, description, utterances)
- ✅ Instantiation with context variables
- ✅ Valid UUID input validation
- ✅ Invalid UUID rejection
- ✅ Required parameter enforcement
- ✅ Vercel tool format conversion
- ✅ Naming pattern consistency

### Test Results
```bash
✓ src/lib/tools/entitycore/__tests__/simulation-tools.test.ts (8)
  ✓ SimulationGetOneTool (6)
  ✓ Tool Registration (2)
```

All tests passed successfully.

## API Endpoint

**Endpoint:** `GET /simulation/{simulation_id}`

**Headers:**
- `virtual-lab-id` (optional): Virtual lab identifier
- `project-id` (optional): Project identifier

**Response:** `SimulationRead` object containing:
- Simulation ID and basic identifiers
- Core simulation information and properties
- Simulation parameters and configuration
- Creation and modification timestamps
- Associated assets
- Entity and campaign relationships

## Integration

The tool is fully integrated into the backend-ts system:

1. **Tool Registry:** Registered in `getToolClasses()` and `getToolMetadata()`
2. **Factory Function:** Available via `createToolInstance('entitycore-simulation-getone', config)`
3. **MCP Server:** Automatically exposed through MCP tool discovery
4. **Type Safety:** Full TypeScript type checking with Zod runtime validation

## Usage Example

```typescript
import { SimulationGetOneTool } from './lib/tools/entitycore/simulation-getone';

const tool = new SimulationGetOneTool({
  httpClient: kyInstance,
  entitycoreUrl: 'https://api.entitycore.example.com',
  entityFrontendUrl: 'https://frontend.example.com',
  vlabId: '123e4567-e89b-12d3-a456-426614174000',
  projectId: '123e4567-e89b-12d3-a456-426614174001',
});

const result = await tool.execute({
  simulation_id: '987fcdeb-51a2-43f7-8b9c-123456789abc',
});

console.log(result.name); // Simulation name
console.log(result.description); // Simulation description
console.log(result.number_neurons); // Number of neurons in simulation
```

## Verification

- ✅ TypeScript compilation successful
- ✅ Unit tests passing (8/8)
- ✅ Build successful
- ✅ Tool registered in index.ts
- ✅ Factory function implemented
- ✅ Follows established patterns
- ✅ Proper error handling
- ✅ Zod schema validation

## Next Steps

Consider implementing the companion tool:
- `entitycore-simulation-getall.ts` - List/search simulations with pagination

## Related Files

- Python source: `backend/src/neuroagent/tools/entitycore_simulation_getone.py`
- TypeScript implementation: `backend-ts/src/lib/tools/entitycore/simulation-getone.ts`
- Test file: `backend-ts/src/lib/tools/entitycore/__tests__/simulation-tools.test.ts`
- Tool registry: `backend-ts/src/lib/tools/index.ts`
- Zod schemas: `backend-ts/src/lib/tools/autogenerated_types/entitycore/zod.gen.ts`
