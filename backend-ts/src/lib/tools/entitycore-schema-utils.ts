/**
 * EntityCore Schema Utilities
 *
 * Translated from backend/src/neuroagent/tools/base_tool.py
 *
 * This module provides utilities for excluding specific fields from EntityCore tool schemas.
 * These exclusions prevent the LLM from using certain parameters directly, encouraging
 * better patterns like semantic search or brain region hierarchy filtering.
 */

/**
 * Brain region fields to exclude from EntityCore tool schemas
 *
 * Equivalent to Python's EntitycoreExcludeBRParams class.
 *
 * These fields are excluded to prevent the LLM from using them directly.
 * Instead, the LLM should use `within_brain_region_brain_region_id` when
 * filtering by brain region. The tool will automatically make an extra request
 * to map the brain region ID to the corresponding hierarchy ID during query execution.
 *
 * Note: Excluding brain_region__id and brain_region__id__in means we cannot filter
 * for entities exactly within a specific region, but this is an accepted trade-off
 * since most use cases care about entities within a region's subtree.
 *
 * To find all fields that match this pattern in Python, run:
 * git grep -n -E ".*brain_region__(name|name__in|name__ilike|id|id__in|acronym|acronym__in):" src/neuroagent/tools/autogenerated_types/entitycore.py
 */
export const ENTITYCORE_EXCLUDE_BR_FIELDS = [
  // Direct brain_region filters
  'brain_region__name',
  'brain_region__name__in',
  'brain_region__name__ilike',
  'brain_region__id',
  'brain_region__id__in',
  'brain_region__acronym',
  'brain_region__acronym__in',

  // emodel__brain_region filters
  'emodel__brain_region__name',
  'emodel__brain_region__name__in',
  'emodel__brain_region__name__ilike',
  'emodel__brain_region__id',
  'emodel__brain_region__id__in',
  'emodel__brain_region__acronym',
  'emodel__brain_region__acronym__in',

  // me_model__brain_region filters
  'me_model__brain_region__name',
  'me_model__brain_region__name__in',
  'me_model__brain_region__name__ilike',
  'me_model__brain_region__id',
  'me_model__brain_region__id__in',
  'me_model__brain_region__acronym',
  'me_model__brain_region__acronym__in',

  // morphology__brain_region filters
  'morphology__brain_region__name',
  'morphology__brain_region__name__in',
  'morphology__brain_region__name__ilike',
  'morphology__brain_region__id',
  'morphology__brain_region__id__in',
  'morphology__brain_region__acronym',
  'morphology__brain_region__acronym__in',

  // synaptome__brain_region filters
  'synaptome__brain_region__name',
  'synaptome__brain_region__name__in',
  'synaptome__brain_region__name__ilike',
  'synaptome__brain_region__id',
  'synaptome__brain_region__id__in',
  'synaptome__brain_region__acronym',
  'synaptome__brain_region__acronym__in',

  // Internal fields that should not be used directly
  'within_brain_region_hierarchy_id',
  'within_brain_region_ascendants',
] as const;

/**
 * Name-based fields to exclude from EntityCore tool schemas
 *
 * Equivalent to Python's EntitycoreExcludeNameParams class.
 *
 * These parameters are excluded to maximize the probability of the LLM using
 * semantic_search instead of direct name-based filtering.
 */
export const ENTITYCORE_EXCLUDE_NAME_FIELDS = [
  'name',
  'name__in',
  'name__ilike',
] as const;

/**
 * Type helper for brain region excluded fields
 */
export type EntitycoreExcludeBRField = (typeof ENTITYCORE_EXCLUDE_BR_FIELDS)[number];

/**
 * Type helper for name excluded fields
 */
export type EntitycoreExcludeNameField = (typeof ENTITYCORE_EXCLUDE_NAME_FIELDS)[number];

/**
 * Create an omit object for Zod schema from brain region excluded fields
 *
 * This generates an object like:
 * {
 *   brain_region__name: true,
 *   brain_region__name__in: true,
 *   ...
 * }
 *
 * Usage:
 * ```typescript
 * const schema = baseSchema.omit(createEntitycoreExcludeBROmit());
 * ```
 */
export function createEntitycoreExcludeBROmit(): Record<EntitycoreExcludeBRField, true> {
  return ENTITYCORE_EXCLUDE_BR_FIELDS.reduce(
    (acc, field) => {
      acc[field] = true;
      return acc;
    },
    {} as Record<EntitycoreExcludeBRField, true>
  );
}

/**
 * Create an omit object for Zod schema from name excluded fields
 *
 * This generates an object like:
 * {
 *   name: true,
 *   name__in: true,
 *   name__ilike: true,
 * }
 *
 * Usage:
 * ```typescript
 * const schema = baseSchema.omit(createEntitycoreExcludeNameOmit());
 * ```
 */
export function createEntitycoreExcludeNameOmit(): Record<EntitycoreExcludeNameField, true> {
  return ENTITYCORE_EXCLUDE_NAME_FIELDS.reduce(
    (acc, field) => {
      acc[field] = true;
      return acc;
    },
    {} as Record<EntitycoreExcludeNameField, true>
  );
}

/**
 * Create a combined omit object for both brain region and name excluded fields
 *
 * Usage:
 * ```typescript
 * const schema = baseSchema.omit(createEntitycoreExcludeBRAndNameOmit());
 * ```
 */
export function createEntitycoreExcludeBRAndNameOmit(): Record<
  EntitycoreExcludeBRField | EntitycoreExcludeNameField,
  true
> {
  return {
    ...createEntitycoreExcludeBROmit(),
    ...createEntitycoreExcludeNameOmit(),
  };
}

/**
 * Helper to check if a field should be excluded for brain region filtering
 *
 * @param fieldName - Field name to check
 * @returns True if the field should be excluded
 */
export function isEntitycoreExcludeBRField(fieldName: string): boolean {
  return (ENTITYCORE_EXCLUDE_BR_FIELDS as readonly string[]).includes(fieldName);
}

/**
 * Helper to check if a field should be excluded for name filtering
 *
 * @param fieldName - Field name to check
 * @returns True if the field should be excluded
 */
export function isEntitycoreExcludeNameField(fieldName: string): boolean {
  return (ENTITYCORE_EXCLUDE_NAME_FIELDS as readonly string[]).includes(fieldName);
}
